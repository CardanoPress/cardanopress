import{l as n,a as e,b as r,h as d,r as c,m as o}from"./util-WIVeI6f2.js";import{g as i,i as h}from"./actions-BibYINJW.js";window.addEventListener("alpine:init",()=>{Alpine.data("paymentForm",()=>({isVerified:!1,isProcessing:!1,payAmount:1,quantity:1,currentBalance:0,remainingBalance:0,transactionHash:"",showAddress:!1,paymentAddress:"",recaptchaKey:"",syncedBalance:!1,async init(){if(this.payAmount=parseFloat(this.$root.dataset.amount),this.paymentAddress=this.$root.dataset.address||"",this.recaptchaKey=this.$root.dataset.recaptcha,this.recaptchaKey===""&&this.paymentAddress===""){this.isVerified=!0;const a=await i();this.paymentAddress=a.data}window.addEventListener("cardanoPress:recaptcha",async a=>{if(this.isVerified=a.detail,this.isVerified&&!this.paymentAddress){const t=await i();this.paymentAddress=t.data}},{once:!0})},isReady(a="extension"){return!!((a!=="extension"?this.isVerified:!this.transactionHash)&&!this.isProcessing)},balanceValue(a,t=!0){const s=this[a+"Balance"];return parseFloat(s)/(t?1e6:1)},lovelaceValue(){return n(this.payAmount)},totalAmount(a=!0){const t=this.payAmount*100*(this.quantity*100)/1e4;return a?t.toFixed(1):n(t)},async syncBalance(){e({id:"balance",type:"info",text:r.walletSyncing}),this.isProcessing=!0;try{const a=await d();this.currentBalance=parseInt(await a.getBalance()),this.remainingBalance=this.currentBalance-parseInt(this.lovelaceValue()),this.syncedBalance=!0}catch(a){e({type:"error",text:a})}c("balance"),this.isProcessing=!1},async handlePayment(){if(this.transactionHash="",e({id:"payment",type:"info",text:r.paying}),!this.paymentAddress){const{success:t,data:s}=await i();t&&(this.paymentAddress=s)}this.isProcessing=!0;const a=await h(this.totalAmount(!1),this.paymentAddress);c("payment"),a.success?(this.transactionHash=a.data.hash,e({type:"info",text:a.data.message})):e({type:"warning",text:a.data}),this.isProcessing=!1}}))}),window.cardanoPressRecaptchaCallback=()=>{const a=t=>window.dispatchEvent(new CustomEvent("cardanoPress:recaptcha",{detail:t}));window.addEventListener("alpine:init",()=>{o("#cardanopress-recaptcha").then(t=>{grecaptcha.render(t,{callback:()=>{a(!0)},"expired-callback":()=>{a(!1)},"error-callback":()=>{a(!1)}})})})};
