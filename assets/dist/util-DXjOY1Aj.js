const __vite__fileDeps=["coinSelection-BK9MdsDt.js","cardano_serialization_lib-DZgxyT4u.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var lt=Object.defineProperty;var ut=(m,g,y)=>g in m?lt(m,g,{enumerable:!0,configurable:!0,writable:!0,value:y}):m[g]=y;var l=(m,g,y)=>(ut(m,typeof g!="symbol"?g+"":g,y),y);let h,L,k,R,X,Z,J,Q,U,j,tt,et,z,q,V,W,C,at,ot,rt,ht=(async()=>{var O,P;let m,g,y,B,S;Z=window.cardanoPress||{ajaxUrl:"",_nonce:"",logged:""},X=window.cardanoPressMessages||{connected:"",connecting:"",reconnected:"",reconnecting:"",walletSyncing:"",newAssetsPulled:"",handleSaving:"",delegating:"",paying:"",clipboardCopy:""},at=(t,e="",o="")=>e+t.charAt(0).toUpperCase()+t.slice(1)+o,j=()=>localStorage.getItem("_x_connectedExtension")||"",Q=t=>localStorage.setItem("_x_connectedExtension",t),et=()=>(localStorage.getItem("_x_isNotified")||"false")==="true",J=t=>localStorage.setItem("_x_isNotified",t),k={0:"testnet",1:"mainnet"},m={too_big:"Transaction too big",not_possible:"Transaction not possible (maybe insufficient balance)",invalid_hereafter:7200},C=Object.freeze(["Nami","Eternl","Yoroi","Flint","Typhon","GeroWallet","NuFi","Lace"]),g="modulepreload",y=function(t){return"/wp-content/plugins/cardanopress/assets/dist/"+t},B={},S=function(t,e,o){let a=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));a=Promise.all(e.map(i=>{if(i=y(i),i in B)return;B[i]=!0;const c=i.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const n=document.createElement("link");if(n.rel=c?"stylesheet":g,c||(n.as="script",n.crossOrigin=""),n.href=i,s&&n.setAttribute("nonce",s),document.head.appendChild(n),c)return new Promise((u,b)=>{n.addEventListener("load",u),n.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${i}`)))})}))}return a.then(()=>t()).catch(r=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r})},h=(O=class{static async load(){return h.Module===void 0&&(h.Module=await S(()=>import("./cardano_serialization_lib-DZgxyT4u.js").then(async t=>(await t.__tla,t)),[])),h.Module}},l(O,"Module"),O);const _=class _{static async load(){return _.Module===void 0&&(_.Module=(await S(()=>import("./index-DwswyeBN.js").then(e=>e.i),[])).Buffer),_.Module}};l(_,"Module");let p=_,T,F,x,E;q=t=>(parseFloat(t||"1")*1e6).toFixed(),T=async t=>{const e=await h.load(),o=await p.load();return e.Address.from_bytes(o.from(t,"hex")).to_bech32()},tt=Object.freeze(Object.defineProperty({__proto__:null,adaToLovelace:q,hexToBech32:T},Symbol.toStringTag,{value:"Module"})),F=async t=>{var a;if(!t)return 0;let e=0;const o=t.keys();for(let r=0;r<t.len();r++){const s=o.get(r),i=(a=t.get(s))==null?void 0:a.keys();for(let c=0;c<i.len();c++)e++}return e},x=async(t,e)=>{const o=await h.load(),a=o.TransactionOutputs.new();return a.add(o.TransactionOutput.new(o.Address.from_bech32(e),o.Value.new(o.BigNum.from_str(t)))),a},E=async(t,e,o,a,r=null)=>{const s=await F(o.get(0).amount().multiasset()),{default:i}=await S(()=>import("./coinSelection-BK9MdsDt.js").then(async w=>(await w.__tla,w)),__vite__mapDeps([0,1]));i.setProtocolParameters(a.minUtxo,a.minFeeA.toString(),a.minFeeB.toString(),a.maxTxSize.toString());let c;try{c=await i.randomImprove(e,o,20+s)}catch{throw m.not_possible}const d=c.input,n=await h.load(),u=n.TransactionBuilder.new(n.LinearFee.new(n.BigNum.from_str(a.minFeeA.toString()),n.BigNum.from_str(a.minFeeB.toString())),n.BigNum.from_str(a.minUtxo),n.BigNum.from_str(a.poolDeposit),n.BigNum.from_str(a.keyDeposit),a.maxValSize,a.maxTxSize);r&&u.set_certs(r);for(let w=0;w<d.length;w++){const f=d[w];u.add_input(f.output().address(),f.input(),f.output().amount())}u.add_output(o.get(0));const b=c.change,v=b.multiasset();if(v&&b.to_bytes().length*2>a.maxValSize){const w=n.Value.new(n.BigNum.from_str("0")),f=n.MultiAsset.new(),it=v.keys();(()=>{for(let M=0;M<v.len();M++){const A=it.get(M),$=v.get(A),H=$.keys(),N=n.Assets.new();for(let I=0;I<H.len();I++){const K=H.get(I),dt=$.get(K);N.insert(K,dt);const Y=n.MultiAsset.from_bytes(f.to_bytes());Y.insert(A,N);const G=n.Value.new(n.BigNum.from_str("0"));if(G.set_multiasset(Y),G.to_bytes().length*2>=a.maxValSize){f.insert(A,N);return}}f.insert(A,N)}})(),w.set_multiasset(f);const ct=n.min_ada_required(w,n.BigNum.from_str(a.minUtxo));w.set_coin(ct),u.add_output(n.TransactionOutput.new(n.Address.from_bech32(t),w))}u.set_ttl(a.slot+m.invalid_hereafter),u.add_change_if_needed(n.Address.from_bech32(t));const D=n.Transaction.new(u.build(),n.TransactionWitnessSet.new());if(D.to_bytes().length*2>a.maxTxSize)throw m.too_big;return D},rt=Object.freeze(Object.defineProperty({__proto__:null,buildTx:E,prepareTx:x},Symbol.toStringTag,{value:"Module"}));class nt{constructor(e,o){l(this,"type");l(this,"cardano");l(this,"getNetwork",async()=>{if(this.type==="Yoroi")return k[1];let e=await this.cardano.getNetworkId();return this.type==="Typhon"&&(e=e.data),k[e]});l(this,"getBalance",async()=>{if(this.type==="Typhon")return(await this.cardano.getBalance()).data.ada;const e=await this.cardano.getBalance(),o=await h.load(),a=await p.load();return o.Value.from_bytes(a.from(e,"hex")).coin().to_str()});l(this,"getChangeAddress",async()=>{if(this.type==="Typhon")return(await this.cardano.getAddress()).data;const e=await this.cardano.getChangeAddress();return await T(e)});l(this,"getRewardAddress",async()=>{if(this.type==="Typhon")return(await this.cardano.getRewardAddress()).data;const e=await this.cardano.getRewardAddresses();return await T(e[0])});l(this,"getUtxos",async()=>{if(this.type==="Typhon")return[];const e=await this.cardano.getUtxos(),o=await h.load(),a=await p.load();return e.map(r=>o.TransactionUnspentOutput.from_bytes(a.from(r,"hex")))});l(this,"getStakeKeyHash",async()=>{var a,r,s;const e=await this.getRewardAddress(),o=await h.load();return(s=(r=(a=o.RewardAddress.from_address(o.Address.from_bech32(e)))==null?void 0:a.payment_cred())==null?void 0:r.to_keyhash())==null?void 0:s.to_bytes()});l(this,"signAndSubmit",async e=>{if(this.type==="Typhon")throw"No implementation from the extension";try{const o=await p.load(),a=await h.load(),r=o.from(e.to_bytes()),s=await this.cardano.signTx(r.toString("hex")),i=a.Transaction.new(e.body(),a.TransactionWitnessSet.from_bytes(o.from(s,"hex")));let c=o.from(i.to_bytes());return await this.cardano.submitTx(c.toString("hex"))}catch(o){throw o.info}});l(this,"payTo",async(e,o,a=null)=>{if(this.type==="Typhon"){const{status:r,data:s,error:i,reason:c}=await this.cardano.paymentTransaction({outputs:[{address:e,amount:o}]});if(r)return s.transactionId;throw i??c}if(!a)throw"Required protocol parameters";try{const r=await this.getChangeAddress(),s=await this.getUtxos(),i=await x(o,e),c=await E(r,s,i,a);return await this.signAndSubmit(c)}catch(r){throw r}});l(this,"delegateTo",async(e,o=null,a=null)=>{if(this.type==="Typhon"){const{status:r,data:s,error:i,reason:c}=await this.cardano.delegationTransaction({poolId:e});if(r)return s.transactionId;throw i??c}if(!o)throw"Required protocol parameters";if(!a)throw"Required account information";try{const r=await this.getChangeAddress(),s=await this.getUtxos(),i=await x(o.keyDeposit,r),c=await this.getStakeKeyHash(),d=await h.load(),n=await p.load(),u=d.Certificates.new();a.active||u.add(d.Certificate.new_stake_registration(d.StakeRegistration.new(d.StakeCredential.from_keyhash(d.Ed25519KeyHash.from_bytes(n.from(c)))))),u.add(d.Certificate.new_stake_delegation(d.StakeDelegation.new(d.StakeCredential.from_keyhash(d.Ed25519KeyHash.from_bytes(n.from(c))),d.Ed25519KeyHash.from_bytes(n.from(e,"hex")))));const b=await E(r,s,i,o,u);return await this.signAndSubmit(b)}catch(r){throw r}});this.type=e,this.cardano=o}}const st=async t=>{const e=await window.cardano[t].enable();if(t==="typhon"){if(e.status===!1)throw(e==null?void 0:e.error)??e.reason;return await window.cardano[t]}return e};L=(P=class{static isSupported(t){return t==="ccvault"&&(t="Eternl"),C.includes(t)}static hasWallet(t){var e;return t==="ccvault"&&(t="Eternl"),this.isSupported(t)?!!((e=window.cardano)!=null&&e[t.toLowerCase()]):!1}static async isEnabled(t){return t==="ccvault"&&(t="Eternl"),this.hasWallet(t)?window.cardano[t.toLowerCase()].isEnabled():!1}static async getWallet(t){if(!this.isSupported(t))throw`Not supported wallet "${t}"`;if(!this.hasWallet(t))throw`Not available wallet "${t}"`;const e=t.toLowerCase(),o=`${e}Object`;if(this[o]===void 0||!await this.isEnabled(t))try{this[o]=new nt(t,await st(e))}catch(a){throw typeof a=="string"?a:a.info||a.message||"user abort connection"}return Object.freeze(this[o])}},l(P,"supported",C),P),V=t=>new Promise(e=>{if(document.querySelector(t))return e(document.querySelector(t));const o=new MutationObserver(()=>{document.querySelector(t)&&(e(document.querySelector(t)),o.disconnect())});o.observe(document.body,{childList:!0,subtree:!0})}),z=()=>{const t=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},R=t=>{window.dispatchEvent(new CustomEvent("cardanoPress:addNotice",{detail:t}))},W=t=>{window.dispatchEvent(new CustomEvent("cardanoPress:removeNotice",{detail:t}))},U=async()=>{const t=j();if(!t)throw"Not connected to a wallet";return await L.getWallet(t)},ot=Object.freeze(Object.defineProperty({__proto__:null,addNotice:R,generateUuid:z,getConnectedWallet:U,removeNotice:W,waitElement:V},Symbol.toStringTag,{value:"Module"}))})();export{h as C,L as E,k as N,ht as __tla,R as a,X as b,Z as c,J as d,Q as e,U as f,j as g,tt as h,et as i,z as j,q as k,V as l,W as r,C as s,at as t,ot as u,rt as w};
