(self.webpackChunkcardanopress=self.webpackChunkcardanopress||[]).push([[873],{840:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=840,t.exports=e},248:(t,e,n)=>{"use strict";n.a(t,(async(t,s)=>{try{n.d(e,{default:()=>y});var i=n(876),r=t([i]);i=(r.then?(await r)():r)[0];let o=null;function u(t,e,n,s){try{t=a(I(t),e,n-t.selection.length,s)}catch(n){if("INPUT_LIMIT_EXCEEDED"!==n.message)throw n;t=m(t,e,s)}return t}function a(t,e,n,s){let i=t.subset.length;if(p(e,t.amount,s,i))return t.remaining=[...t.remaining,...t.subset],t.subset=[],t;if(n<=0)throw new Error("INPUT_LIMIT_EXCEEDED");if(i<=0){if(p(e,t.amount,0,0))throw new Error("MIN_UTXO_ERROR");throw new Error("INPUTS_EXHAUSTED")}let r=t.subset.splice(Math.floor(Math.random()*i),1).pop();return t.selection.push(r),t.amount=g(r.output().amount(),t.amount),a(t,e,n-1,s)}function m(t,e,n){t.subset=t.subset.sort(((t,n)=>Number(h(e,n.output().amount())-h(e,t.output().amount()))));do{if(t.subset.length<=0){if(p(e,t.amount,0,0))throw new Error("MIN_UTXO_ERROR");throw new Error("INPUTS_EXHAUSTED")}let n=t.subset.splice(0,1).pop();t.selection.push(n),t.amount=g(n.output().amount(),t.amount)}while(!p(e,t.amount,n,t.subset.length-1));return t.remaining=[...t.remaining,...t.subset],t.subset=[],t}function l(t,e,n,s){let r=t.subset.length;if(B(t.amount,s.ideal)>=0||r<=0||n<=0)return t.remaining=[...t.remaining,...t.subset],void(t.subset=[]);const o=t.subset.splice(Math.floor(Math.random()*r),1).pop(),u=i.WTA.new(i.tR8.from_str("0")).checked_add(o.output().amount()).checked_add(e);return k(d(s.ideal)-d(u))<k(d(s.ideal)-d(e))&&B(u,s.maximum)<=0?(t.selection.push(o),t.amount=g(o.output().amount(),t.amount),n--):t.remaining.push(o),l(t,e,n,s)}function c(t){let e=i.WTA.new(i.tR8.from_str("0"));for(let n=0;n<t.len();n++)e=g(t.get(n).amount(),e);return e}function g(t,e){return e.checked_add(t)}function f(t){let e=[];if(t.multiasset()){let n=t.multiasset();for(let t=0;t<n.keys().len();t++){let s=n.keys().get(t);for(let t=0;t<n.get(s).keys().len();t++){let r=i.sP.new(),o=n.get(s).keys().get(t);r.insert(i.S2x.from_bytes(o.to_bytes()),i.tR8.from_bytes(n.get(s).get(o).to_bytes()));let u=i.m5h.new();u.insert(i.QaT.from_bytes(s.to_bytes()),r);let a=i.WTA.new(i.tR8.from_str("0"));a.set_multiasset(u),e.push(a)}}}return e=_(e,"DESC"),e.push(i.WTA.new(i.tR8.from_bytes(t.coin().to_bytes()))),e}function _(t,e="ASC"){return t.sort(((t,n)=>{let s="DESC"===e?BigInt(-1):BigInt(1);return Number((d(t)-d(n))*s)}))}function d(t){let e=BigInt(0),n=BigInt(t.coin().to_str());if(n>0)e=n;else if(t.multiasset()&&t.multiasset().len()>0){let n=t.multiasset().keys().get(0),s=t.multiasset().get(n).keys().get(0);e=BigInt(t.multiasset().get(n).get(s).to_str())}return e}function h(t,e){let n=BigInt(0);if(BigInt(t.coin().to_str())>0)n=BigInt(e.coin().to_str());else if(t.multiasset()&&e.multiasset()&&t.multiasset().len()>0&&e.multiasset().len()>0){let s=t.multiasset().keys().get(0),i=t.multiasset().get(s).keys().get(0);n=BigInt(e.multiasset().get(s).get(i).to_str())}return n}function b(t,e){if(BigInt(e.coin().to_str())<BigInt(1)){let n=[],s=[];for(let i=0;i<t.remaining.length;i++)void 0!==B(t.remaining[i].output().amount(),e)?n.push(t.remaining[i]):s.push(t.remaining[i]);t.subset=n,t.remaining=s}else t.subset=t.remaining.splice(0,t.remaining.length)}function p(t,e,n,s){let r=t;if(n&&BigInt(t.coin().to_str())>0){let u=i.WTA.new(i.Kq(e,i.tR8.from_str(n.toString())));if(B(e,u)<0)return!1;if(B(t,u)<0&&(r=u.checked_add(i.WTA.new(i.tR8.from_str(o.minUTxO)))),s>0){let t=BigInt(o.minFeeA)*BigInt(o.maxTxSize)+BigInt(o.minFeeB);t=i.WTA.new(i.tR8.from_str(t.toString())),r=r.checked_add(t)}}return B(e,r)>=0}function I(t){return{selection:w(t.selection),remaining:w(t.remaining),subset:w(t.subset),amount:T(t.amount)}}const w=t=>t.map((t=>i.Hlu.from_bytes(t.to_bytes()))),T=t=>i.WTA.from_bytes(t.to_bytes());function k(t){return t<0?t*BigInt(-1):t}function B(t,e){let n=BigInt(t.coin().to_str()),s=BigInt(e.coin().to_str());if(e.multiasset()){let i=e.multiasset().keys().get(0),r=e.multiasset().get(i).keys().get(0);if(!t.multiasset()||!t.multiasset().len())return;if(!t.multiasset().get(i)||!t.multiasset().get(i).get(r))return;n=BigInt(t.multiasset().get(i).get(r).to_str()),s=BigInt(e.multiasset().get(i).get(r).to_str())}return n>=s?n===s?0:1:-1}const y={setProtocolParameters:(t,e,n,s)=>{o={minUTxO:t,minFeeA:e,minFeeB:n,maxTxSize:s}},randomImprove:async(t,e,n)=>{if(!o)throw new Error("Protocol parameters not set. Use setProtocolParameters().");const s=BigInt(e.len())*BigInt(o.minUTxO);let r={selection:[],remaining:[...t],subset:[],amount:i.WTA.new(i.tR8.from_str("0"))},a=c(e),m=f(a);for(let t=0;t<m.length;t++)b(r,m[t]),r=u(r,m[t],n,s);m=_(m);for(let t=0;t<m.length;t++){b(r,m[t]);let e={};e.ideal=i.WTA.new(i.tR8.from_str("0")).checked_add(m[t]).checked_add(m[t]),e.maximum=i.WTA.new(i.tR8.from_str("0")).checked_add(e.ideal).checked_add(m[t]),l(r,m[t],n-r.selection.length,e)}if(r.remaining.length>0){const t=r.amount.checked_sub(a);let e=i.WTA.new(i.Kq(t,i.tR8.from_str(o.minUTxO))),m=BigInt(o.minFeeA)*BigInt(o.maxTxSize)+BigInt(o.minFeeB);if(m=i.WTA.new(i.tR8.from_str(m.toString())),e=e.checked_add(m),B(t,e)<0){const o=e.checked_sub(i.WTA.new(t.coin())).checked_add(i.WTA.new(r.amount.coin()));b(r,o),r=u(r,o,n,s)}}return{input:r.selection,output:e,remaining:r.remaining,amount:r.amount,change:r.amount.checked_sub(a)}}};s()}catch(E){s(E)}}))}}]);